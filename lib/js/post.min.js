"use strict";window.tsfPost=function(){function a(){if(!document.querySelector(".tsf-flex"))return;const a=document.getElementById("tsf-flex-inpost-tabs-wrapper"),b=new Map,c=a=>{const d=a.querySelector(".tsf-flex-nav-tab-inner"),e=a.querySelectorAll(".tsf-flex-nav-name");if(d.clientWidth<=a.clientWidth){if(+(a.dataset.displayedNames||1))return;a.dataset.displayedNames=1,e.forEach(a=>{a.style.display=null,tsfUI.fadeIn(a)})}else{if(!+(a.dataset.displayedNames||1))return;a.dataset.displayedNames=0,e.forEach(a=>{a.style.display="none"})}+a.dataset.displayedNames&&(d.clientWidth>a.clientWidth?(e.forEach(a=>{a.style.display="none"}),a.dataset.displayedNames=0):setTimeout(()=>{cancelAnimationFrame(b.get(a.id)),b.set(a.id,requestAnimationFrame(()=>c(a)))},1e3/144))};window.addEventListener("tsf-flex-resize",d=>{const e=d.detail.target||a;e&&b.set(e.id,requestAnimationFrame(()=>c(e)))});const d=a=>{window.dispatchEvent(new CustomEvent("tsf-flex-resize",{bubbles:!1,cancelable:!1,detail:{target:a}}))};let e={};const f=new ResizeObserver(a=>{for(const b of a){let a=b.target;cancelAnimationFrame(e[a.id]),e[a.id]=requestAnimationFrame(()=>{a.dataset.lastWidth||=0,+a.clientWidth!=+a.dataset.lastWidth&&(a.dataset.lastWidth=a.clientWidth,d(a))})}});a&&f.observe(a),d()}function b(){tsfTabs.initStack("tsfSettings",{tabToggledEvent:new CustomEvent("tsf-flex-tab-toggled"),HTMLClasses:{wrapper:"tsf-flex-nav-tab-wrapper",tabRadio:"tsf-flex-nav-tab-radio",tabLabel:"tsf-flex-nav-tab-label",activeTab:"tsf-flex-tab-active",activeTabContent:"tsf-flex-tab-content-active"},fixHistory:!0})}function c(){let a=[...document.getElementsByName("visibility")].filter(a=>a.checked)?.[0]?.value;if("password"===a){const b=document.getElementById("post_password")?.value;b?.length&&"0"===b&&(a="public")}return a}function d(a){document.addEventListener("tsf-updated-block-editor-visibility",b=>a(b.detail.value)),a=tsfUtils.debounce(a,20),document.querySelector("#visibility .save-post-visibility")?.addEventListener("click",()=>a(c()))}function e(){const a=document.getElementById("autodescription_noindex"),b=document.getElementById("autodescription_canonical"),c=new Map,e=1,f=2;let g=0;tsfCanonical.setInputElement(b);const h=JSON.parse(document.getElementById(`tsf-canonical-data_${p}`)?.dataset.state||0);h&&(tsfCanonical.updateStateOf(p,"allowReferenceChange",!h.refCanonicalLocked),tsfCanonical.updateStateOf(p,"defaultCanonical",h.defaultCanonical.trim()),tsfCanonical.updateStateOf(p,"preferredScheme",h.preferredScheme.trim()),tsfCanonical.updateStateOf(p,"urlStructure",h.urlStructure)),tsfCanonical.enqueueTriggerUnregisteredInput(p);const i=()=>{tsfCanonical.updateStateOf(p,"showUrlPlaceholder",!(g&e||g&f)),tsfCanonical.updateStateOf(p,"urlDataParts",Object.fromEntries(c.entries()))};if(b){let a={},b="",d="",e="",f="";const g=tsfCanonical.structIncludes(p,"%postname%"),j=tsfCanonical.structIncludes(p,["%year%","%monthnum%","%day%","%hour%","%minute%","%second%"]),k={},l=tsfCanonical.structIncludes(p,"%author%");for(const[b,c]of Object.entries(h.parentTermSlugs))tsfTermSlugs.store(c,b),a[b]=c,k[b]=tsfCanonical.structIncludes(p,`%${b}%`);l&&Object.entries(h.authorSlugs).forEach(([a,c])=>{tsfAuthorSlugs.store(a,c),b=c});const n=tsfUtils.debounce(()=>{const g=f||e||"",h=encodeURIComponent(g.substring(0,200).toLowerCase().replace(/\s+/g,"-"));if(c.set(`%post_id%`,m.states.id).set(`%postname%`,h).set(`%author%`,b),j){const a=new Date(d),b=a=>(a+"").padStart(2,"0");c.set(`%year%`,a.getFullYear()).set(`%monthnum%`,b(a.getMonth()+1)).set(`%day%`,b(a.getDate())).set(`%hour%`,b(a.getHours())).set(`%minute%`,b(a.getMinutes())).set(`%second%`,b(a.getSeconds()))}for(const b in k)k[b]&&c.set(`%${b}%`,Object.values(a[b]??{}).join("/"));i()},1e3/60);if(document.addEventListener("tsf-updated-block-editor",async a=>{switch(a.detail.type){case"title":g&&(e=a.detail.postData.get("title"),n());break;case"slug":g&&(f=a.detail.postData.get("slug"),n());break;case"author":l&&(b=await tsfAuthorSlugs.get(a.detail.postData.get("author")),n());break;case"date":j&&(d=new Date(a.detail.postData.get("date")).toISOString(),n())}}),Object.values(k).includes(!0)){const b=tsfUtils.debounce(async b=>{const c=b.detail.taxonomy;k[c]&&(a[c]=await tsfTermSlugs.get(b.detail.id,c),n())},100);document.addEventListener(`tsf-updated-primary-term`,b)}if(!m.states.isGutenbergPage){if(g){const a=document.getElementById("edit-slug-box"),b=document.getElementById("post_name"),c=document.getElementById("title"),d=()=>{e=c?.value??"",f=b?.value??document.getElementById("editable-post-name-full")?.innerText,n()};a&&new MutationObserver(a=>{for(const b of a)if(b.addedNodes.entries().some(([,a])=>"editable-post-name-full"===a.id)){d();break}}).observe(a,{childList:!0,subtree:!0}),b?.addEventListener("input",d),d()}if(l){const a=document.getElementById("post_author_override")??document.getElementById("post_author");if(a){const c=tsfUtils.debounce(async()=>{b=await tsfAuthorSlugs.get(a.value),n()},100);a.addEventListener("input",c),c()}}if(j){const a=[document.getElementById("aa"),document.getElementById("mm"),document.getElementById("jj"),document.getElementById("hh"),document.getElementById("mn"),document.getElementById("ss")],b=()=>{const b=a.map(a=>a.value);return b[1]&&--b[1],b.map(a=>a??"00")},c=()=>{d=new Date(...b()).toISOString(),n()};a.forEach(a=>{a?.addEventListener("change",c)}),c()}n()}}if(a){const b=b=>{let c=a.querySelector("[value=\"0\"]"),d="";switch(b){case"password":case"private":d="noindex",g|=e;break;default:case"public":d=a.dataset.defaultUnprotected,g&=~e}c&&(c.innerHTML=a.dataset.defaultI18n.replace("%s",tsf.escapeString(tsf.decodeEntities(d)))),i()};d(b),m.states.isPrivate?b("private"):m.states.isProtected?b("password"):b("public");const c=b=>{let c="";switch(+b){case 0:c=a.dataset.defaultUnprotected;break;case-1:c="index";break;case 1:c="noindex"}"noindex"===c?g|=f:g&=~f,i()};a.addEventListener("change",a=>c(a.target.value)),c(a.value)}}function f(){const a=document.getElementById(n);if(!a)return;tsfTitle.setInputElement(a);const b=JSON.parse(document.getElementById(`tsf-title-data_${n}`)?.dataset.state||0);b&&(tsfTitle.updateStateOf(n,"allowReferenceChange",!b.refTitleLocked),tsfTitle.updateStateOf(n,"defaultTitle",b.defaultTitle),tsfTitle.updateStateOf(n,"addAdditions",b.addAdditions),tsfTitle.updateStateOf(n,"additionValue",b.additionValue),tsfTitle.updateStateOf(n,"additionPlacement",b.additionPlacement));const c=a=>{let b=!a.target.checked;m.params.additionsForcedDisabled?b=!1:m.params.additionsForcedEnabled&&(b=!0),tsfTitle.updateStateOf(n,"addAdditions",b)},e=document.getElementById("autodescription_title_no_blogname");e&&(e.addEventListener("change",c),e.dispatchEvent(new Event("change")));const f=a=>{let b="";switch(a){case"password":b=tsfTitle.protectedPrefix;break;case"private":b=tsfTitle.privatePrefix;break;default:case"public":b=""}tsfTitle.updateStateOf(n,"prefixValue",b)};d(f),m.states.isPrivate?f("private"):m.states.isProtected&&f("password");const g=a=>{a=a?.trim()||"",tsfTitle.updateStateOf(n,"defaultTitle",(tsfTitle.stripTitleTags?tsf.stripTags(a):a)||tsfTitle.untitledTitle)};m.params.isFront||(document.querySelector("#titlewrap #title")?.addEventListener("input",a=>{g(a.target.value)}),document.addEventListener("tsf-updated-block-editor-title",a=>g(a.detail.value))),tsfTitle.enqueueUnregisteredInputTrigger(n)}function g(){const a=document.getElementById(o);if(a){tsfDescription.setInputElement(a);const b=JSON.parse(document.getElementById(`tsf-description-data_${o}`)?.dataset.state||0);b&&(tsfDescription.updateStateOf(o,"allowReferenceChange",!b.refDescriptionLocked),tsfDescription.updateStateOf(o,"defaultDescription",b.defaultDescription.trim())),tsfDescription.enqueueUnregisteredInputTrigger(o);const c=a=>{let b=tsfDescription.getStateOf(o,"useDefaultDescription"),c=!0;switch(a){case"password":case"private":c=!1;break;default:case"public":c=!0}c!==b&&tsfDescription.updateStateOf(o,"useDefaultDescription",c)};d(c),m.states.isPrivate?c("private"):m.states.isProtected&&c("password")}}function h(){tsfSocial.setInputInstance(q,n,o);const a=JSON.parse(document.getElementById(`tsf-social-data_${q}`)?.dataset.settings||0);a&&(tsfSocial.updateStateOf(q,"addAdditions",a.og.state.addAdditions),tsfSocial.updateStateOf(q,"defaults",{ogTitle:a.og.state.defaultTitle,twTitle:a.tw.state.defaultTitle,ogDesc:a.og.state.defaultDesc,twDesc:a.tw.state.defaultDesc}),tsfSocial.updateStateOf(q,"inputLocks",{ogTitle:a.og.state?.titleLock||!1,twTitle:a.tw.state?.titleLock||!1,ogDesc:a.og.state?.descLock||!1,twDesc:a.tw.state?.descLock||!1}))}function i(){const a=()=>{tsfTitle.enqueueUnregisteredInputTrigger(n),tsfDescription.enqueueUnregisteredInputTrigger(o)};document.getElementById("tsf-flex-inpost-tab-general")?.addEventListener("tsf-flex-tab-toggled",a),window.addEventListener("tsf-flex-resize",a)}function j(){if(!m.states.isGutenbergPage)return;const a=document.querySelector(".tsf-seo-bar"),b=document.querySelector("#tsf-doing-it-right-wrap .tsf-ajax"),c=document.getElementById("autodescription_socialimage-url"),d=tsfSocial.getInputInstance(q)?.inputs?.ogDesc,e=tsfSocial.getInputInstance(q)?.inputs?.twDesc,f={seobar:!!a,metadescription:!!document.getElementById(o),ogdescription:!!d,twdescription:!!e,imageurl:!!c},g=d=>{d=tsf.convertJSONResponse(d);const e=75;setTimeout(()=>{tsfDescription.updateStateOf(o,"defaultDescription",d.data.metadescription.trim());const a=tsfSocial.getStateOf(q,"defaults");a.ogDesc=d.data.ogdescription.trim(),a.twDesc=d.data.twdescription.trim(),tsfSocial.updateStateOf(q,"defaults",a),c&&(c.placeholder=tsf.decodeEntities(d.data.imageurl),c.dispatchEvent(new Event("change")),tsfTT.triggerReset()),tsfAys.reset()},e),a&&tsfUI.fadeOut(a,e,()=>{b&&tsf.unsetAjaxLoader(b,!0),a.innerHTML=d.data.seobar,tsfUI.fadeIn(a,e,()=>{tsfTT.triggerReset()})})},h=()=>{b&&tsf.unsetAjaxLoader(b,!1)};document.addEventListener("tsf-gutenberg-onsave",()=>{b&&tsf.resetAjaxLoader(b),b&&tsf.setAjaxLoader(b),wp.ajax.send("tsf_update_post_data",{data:{nonce:m.nonces.edit_post[m.states.id],post_id:m.states.id,get:f},timeout:7e3}).done(g).fail(h)})}function k(){e(),f(),g(),h(),i()}function l(){a(),b(),j()}const m=tsfPostL10n,n="autodescription_title",o="autodescription_description",p="autodescription_canonical",q="autodescription_social_singular";return Object.assign({load:()=>{document.body.addEventListener("tsf-onload",k),document.body.addEventListener("tsf-ready",l)}},{l10n:m})}(),window.tsfPost.load();
